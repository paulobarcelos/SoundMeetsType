(function(){if(!1===/chrome/.test(navigator.userAgent.toLowerCase()))throw alert("Sorry. Your browser is not compatible with WAAX. Use Chrome 24+ to use WAAX."),"[WAAX] Error: Incompatible browser.";if(24>parseInt(window.navigator.appVersion.match(/Chrome\/(.*?) /)[1],10))throw alert("Sorry. Chrome 24+ is required to use WAAX."),"[WAAX] Error: Outdated Chrome.";})();
var WX=WX||Object.create(null,{_version:{value:{number:0,revision:5}},_context:{value:new webkitAudioContext},now:{get:function(){return this._context.currentTime},set:function(){}},version:{get:function(){return this._version.revision},set:function(){}},getContext:{value:function(){return this._context}},Types:{value:Object.freeze({Unit:"Unit.",Generator:"Generator.",Processor:"Processor.",Analyzer:"Analyzer."})},Template:{value:Object.create(null),writable:!0},Internal:{value:Object.create(null),
writable:!0},Unit:{value:Object.create(null),writable:!0}});console.log("[WAAX] Starting... (r"+WX.version+")");WX.Unit.Common=function(){Object.defineProperties(this,{_label:{value:WX.Types.Unit,enumerable:!1,writable:!0}})};
WX.Unit.Common.prototype=Object.create(null,{label:{enumerable:!1,get:function(){return this._label},set:function(a){this._label=a}},params:{enumerable:!1,get:function(){var a=Object.create(null),b;for(b in this)a[b]=this[b];return a},set:function(a){"object"!==typeof a&&WX.error(this,"invalid JSON.");for(var b in a)void 0!==this[b]?this[b]=a[b]:WX.warn(this,b+" is not an available property.")}},toString:{value:function(){var a=this.label;return a+=" <pre>"+JSON.stringify(this.params,null,2)+"</pre>"}}});
WX.Unit.Generator=function(){WX.Unit.Common.call(this);Object.defineProperties(this,{_outputGain:{value:WX._context.createGain()},_outlet:{value:WX._context.createGain()},_active:{value:!0,writable:!0}});this._outputGain.connect(this._outlet);this.label+=WX.Types.Generator;WX.bindParam.call(this,"mgain",this._outputGain.gain)};
WX.Unit.Generator.prototype=Object.create(WX.Unit.Common.prototype,{to:{value:function(a){if("[object GainNode]"===Object.prototype.toString.call(a._inlet))return this._outlet.connect(a._inlet),a;WX.error(this,"invalid inlet node in target unit.")}},cut:{value:function(){this._outlet.disconnect()}},connect:{value:function(a){this._outlet.connect(a)}},gain:{enumerable:!0,get:function(){return this._outputGain.gain.value},set:function(a){this._outputGain.gain.value=a}},active:{enumerable:!0,get:function(){return this._active},
set:function(a){"boolean"===typeof a&&((this._active=a)?this._outputGain.connect(this._outlet):this._outputGain.disconnect())}}});
WX.Unit.Processor=function(){WX.Unit.Common.call(this);Object.defineProperties(this,{_inlet:{value:WX._context.createGain()},_inputGain:{value:WX._context.createGain()},_outputGain:{value:WX._context.createGain()},_outlet:{value:WX._context.createGain()},_bypass:{value:!1,writable:!0}});this._inlet.connect(this._inputGain);this._outputGain.connect(this._outlet);this.label+=WX.Types.Processor;WX.bindParam.call(this,"mgain",this._outputGain.gain)};
WX.Unit.Processor.prototype=Object.create(WX.Unit.Common.prototype,{to:{value:function(a){if("[object GainNode]"===Object.prototype.toString.call(a._inlet))return this._outlet.connect(a._inlet),a;WX.error(this,"invalid inlet node in target unit.")}},cut:{value:function(){this._outlet.disconnect()}},connect:{value:function(a){this._outlet.connect(a)}},gain:{enumerable:!0,get:function(){return this._outputGain.gain.value},set:function(a){this._outputGain.gain.value=a}},bypass:{enumerable:!0,get:function(){return this._bypass},
set:function(a){"boolean"===typeof a&&((this._bypass=a)?(this._outputGain.disconnect(),this._inlet.connect(this._outlet)):(this._inlet.disconnect(),this._inlet.connect(this._inputGain),this._outputGain.connect(this._outlet)))}}});
WX.Unit.Analyzer=function(){WX.Unit.Common.call(this);Object.defineProperties(this,{_inlet:{value:WX._context.createGain()},_inputGain:{value:WX._context.createGain()},_analyzer:{value:WX._context.createAnalyser()},_active:{value:!0,writable:!0}});this._inlet.connect(this._inputGain);this._inputGain.connect(this._analyzer);this.label+=WX.Types.Analyzer;WX.bindParam.call(this,"mgain",this._inputGain.gain)};
WX.Unit.Analyzer.prototype=Object.create(WX.Unit.Common.prototype,{gain:{enumerable:!0,get:function(){return this._inputGain.gain.value},set:function(a){this._inputGain.gain.value=a}},active:{enumerable:!0,get:function(){return this._active},set:function(a){"boolean"===typeof a&&((this._active=a)?this._inlet.connect(this._inputGain):this._inlet.disconnect())}}});WX._at=null;WX.at=function(a,b){WX._at=a+WX.now;b.call();WX._at=null};
WX.bindParam=function(a,b){var c=this[a+"_"]=b;this[a]=function(a,b,e){if(void 0===a)return c.value;var f=WX._at?WX._at:WX.now;switch(e){case void 0:c.setValueAtTime(a,f);break;case "line":c.linearRampToValueAtTime(a,f+b);break;case "expo":c.exponentialRampToValueAtTime(a,f+b);break;default:c.setValueAtTime(a,f)}return this}};WX.link=function(){for(var a=arguments.length-1;1<=a;--a)arguments[a-1].to(arguments[a])};WX.cut=function(){for(var a=arguments.length-1;0<=a;--a)arguments[a].cut()};Object.defineProperties(WX,{PI:{value:Math.PI},TWOPI:{value:2*Math.PI},EPS:{value:Number.MIN_VALUE},NoteName:{value:{A0:21,B0:23,C1:24,D1:26,E1:28,F1:29,G1:31,A1:33,B1:35,C2:36,D2:38,E2:40,F2:41,G2:43,A2:45,B2:47,C3:48,D3:50,E3:52,F3:53,G3:55,A3:57,B3:59,C4:60,D4:62,E4:64,F4:65,G4:67,A4:69,B4:71,C5:72,D5:74,E5:76,F5:77,G5:79,A5:81,B5:83,C6:84,D6:86,E6:88,F6:89,G6:91,A6:93,B6:95,C7:96,D7:98,E7:100,F7:101,G7:103,A7:105,B7:107,C8:108}},random2f:{value:function(a,b){return a+Math.random()*(b-a)}},random2:{value:function(a,
b){return Math.round(a+Math.random()*(b-a))}},pitch2freq:{value:function(a){return 440*Math.pow(2,(Math.floor(a)-69)/12)}},freq2pitch:{value:function(a){return Math.floor(69+12*Math.log(a/440)/Math.log(2))}},lin2db:{value:function(a){return 20*(1E-5<a?Math.log(a)/Math.LN10:-5)}},db2lin:{value:function(a){return Math.pow(10,a/20)}},info:{value:function(a,b){console.log("[WX:"+a.label+"] Info: "+b)}},warn:{value:function(a,b){console.log("[WX:"+a.label+"] Warning: "+b)}},error:{value:function(a,b){throw Error("[WX:"+
a.label+"] Error: "+b);}}});WX.Internal.DualLevelDetector=function(){Object.defineProperties(this,{_fs:{enumerable:!1,writable:!1,value:WX._context.sampleRate},_attackFast:{enumerable:!1,writable:!0,value:1},_releaseFast:{enumerable:!1,writable:!0,value:1},_levelFast:{enumerable:!1,writable:!0,value:0},_attackSlow:{enumerable:!1,writable:!0,value:1},_releaseSlow:{enumerable:!1,writable:!0,value:1},_levelSlow:{enumerable:!1,writable:!0,value:0}});this.reset()};
WX.Internal.DualLevelDetector.prototype=Object.create(null,{attack:{enumerable:!0,get:function(){return this._attackFast},set:function(a){this._attackFast=1-Math.exp(-1/(a*this._fs))}},release:{enumerable:!0,get:function(){return this._releaseFast},set:function(a){this._releaseFast=1-Math.exp(-1/(a*this._fs))}},reset:{enumerable:!1,value:function(){this._attackFast=1-Math.exp(-1/(0.125*this._fs));this._releaseFast=1-Math.exp(-1/(0.5*this._fs));this._attackSlow=1-Math.exp(-1/(0.25*this._fs));this._releaseSlow=
1-Math.exp(-1/this._fs);this._levelSlow=this._levelFast=0}},process:{value:function(a){a=Math.abs(a);this._levelSlow=a>this._levelSlow?this._levelSlow+this._attackSlow*(a-this._levelSlow):this._levelSlow+this._releaseSlow*(a-this._levelSlow);return this._levelFast=a>this._levelFast?this._levelFast+this._attackFast*(a-this._levelFast):this._levelFast+this._releaseFast*(this._levelSlow-this._levelFast)}}});
WX.Internal.RingBuffer=function(a,b){var c=a||512;bn=b||8;Object.defineProperties(this,{_blockSize:{enumerable:!1,writable:!1,value:c},_bufferSize:{enumerable:!1,writable:!1,value:c*bn},_buffer:{enumerable:!1,writable:!0,value:void 0},_writer:{enumerable:!1,writable:!0,value:0},_reader:{enumerable:!1,writable:!0,value:0}});this._buffer=new Float32Array(this._bufferSize)};
WX.Internal.RingBuffer.prototype=Object.create(null,{writeBlock:{enumerable:!0,value:function(a){for(var b=this._writer+this._blockSize,c=0;this._writer<b;)this._buffer[this._writer++]=a[c++];this._writer==this._bufferSize&&(this._writer=0);this._reader=this._writer}},copyBuffertoArray:{enumerable:!0,value:function(a){for(var b=0,c=this._bufferSize,d=this._reader;b<c;)a[b++]=this._buffer[d++],d==c&&(d=0)}}});(function(){var a=WX._context.sampleRate,b=5*a,c=new Float32Array(b);WX.Template.WhiteNoise=WX._context.createBuffer(1,b,a);for(a=0;a<b;++a)c[a]=2*Math.random()-1;WX.Template.WhiteNoise.getChannelData(0).set(c,0)})();WX.Loop=function(a,b,c){Object.defineProperties(this,{_index:{writable:!0,value:0},_repetition:{value:b||0},_interval:{writable:!0,value:c||1},_next:{writable:!0,value:0},_checkup:{value:1E3/30},_ahead:{value:1},_infinite:{writable:!0,value:!1},_continue:{writable:!0,value:!0},_timerId:{writable:!0,value:null},_callback:{writable:!0,value:a||function(){}}});this._infinite=0===this._repetition?!0:!1};
WX.Loop.prototype=Object.create(null,{_loop:{value:function(){this._next<WX.now+this._ahead&&(this._callback.call(this,this._next,this._index),this._next+=this._interval,this._infinite||(this._continue=++this._index>=this._repetition?!1:!0));if(this._continue){var a=this;this._timerId=setTimeout(function(){a._loop()},this._checkup)}}},start:{value:function(){clearTimeout(this._timerId);this._loop()}},stop:{value:function(){clearTimeout(this._timerId);this._continue=!1}}});WX.LFO=function(a){WX.Unit.Generator.call(this);this.label+="LFO";Object.defineProperties(this,{_lfo:{enumerable:!1,writable:!1,value:WX._context.createOscillator()},_defaults:{value:{rate:5,shape:"sine",depth:1}}});this._lfo.connect(this._outputGain);this._lfo.noteOn(0);this.params=this._defaults;"object"===typeof a&&(this.params=a)};
WX.LFO.prototype=Object.create(WX.Unit.Generator.prototype,{rate:{enumerable:!0,get:function(){return this._lfo.frequency.value},set:function(a){a=Math.max(0,Math.min(20,a));this._lfo.frequency.value=a}},depth:{enumerable:!0,get:function(){return this._outputGain.gain.value},set:function(a){this._outputGain.gain.value=a}},shape:{enumerable:!0,get:function(){return this._lfo.type},set:function(a){this._lfo.type=a}}});WX.Noise=function(a){WX.Unit.Generator.call(this);this.label+="Noise";Object.defineProperties(this,{_source:{enumerable:!1,writable:!1,value:WX._context.createBufferSource()},_type:{enumerable:!1,writable:!0,value:"white"},_defaults:{value:{type:"white"}}});this._source.connect(this._outputGain);this._source.buffer=WX.Template.WhiteNoise;this._source.loop=1;this._source.noteOn(0);this.params=this._defaults;"object"===typeof a&&(this.params=a)};
WX.Noise.prototype=Object.create(WX.Unit.Generator.prototype,{type:{enumerable:!0,get:function(){return this._type},set:function(a){this._type=a}}});WX.Oscil=function(a){WX.Unit.Generator.call(this);Object.defineProperties(this,{_oscil:{enumerable:!1,writable:!1,value:WX._context.createOscillator()},_defaults:{value:{frequency:440,type:"sine",gain:1}},modulationTarget:{enumerable:!0,writable:!0,value:{frequency:null,gain:null}}});this._oscil.connect(this._outputGain);this._oscil.start(0);this.params=this._defaults;"object"===typeof a&&(this.params=a);this.label+="Oscil";WX.bindParam.call(this,"mfreq",this._oscil.frequency)};
WX.Oscil.prototype=Object.create(WX.Unit.Generator.prototype,{frequency:{enumerable:!0,get:function(){return this._oscil.frequency.value},set:function(a){this._oscil.frequency.cancelScheduledValues(0);this._oscil.frequency.setValueAtTime(a,0)}},glide:{value:function(a,b){var c=WX._context.currentTime,d=this._oscil.frequency;d.setValueAtTime(d.value,c);d.linearRampToValueAtTime(a,c+b)}},pitch:{enumerable:!0,get:function(){return WX.freq2pitch(this._oscil.frequency.value)},set:function(a){this._oscil.frequency.value=
WX.pitch2freq(a)}},type:{enumerable:!0,get:function(){return this._oscil.type},set:function(a){if(void 0!==a){switch(a){case "sine":case 0:a=0;break;case "square":case 1:a=1;break;case "sawtooth":case 2:a=2;break;case "triangle":case 3:a=3;break;default:a=0}this._oscil.type=a}}}});WX.ImpTrain=function(a){WX.Unit.Generator.call(this);this.label+="ImpTrain";Object.defineProperties(this,{_generator:{enumerable:!1,writable:!1,value:WX._context.createScriptProcessor(256,1,1)},_period:{enumerable:!1,writable:!0,value:0},_phase:{enumerable:!1,writable:!0,value:0},_dc:{enumerable:!1,writable:!0,value:0},_frequency:{enumerable:!1,writable:!0,value:440},_defaults:{value:{frequency:440,gain:1}}});var b=this;this._generator.onaudioprocess=function(a){b._callback(a)};this._generator.connect(this._outputGain);
this.params=this._defaults;"object"===typeof a&&(this.params=a)};
WX.ImpTrain.prototype=Object.create(WX.Unit.Generator.prototype,{_callback:{value:function(a){a=a.outputBuffer.getChannelData(0);for(var b=0;256>b;++b){var c=0;0>this._phase&&(c=1-(1+this._phase),this._phase+=this._period);a[b]=c-this._dc;this._phase-=1}}},frequency:{enumerable:!0,get:function(){return this._frequency},set:function(a){this._frequency=a;this._period=WX._context.sampleRate/this._frequency;this._dc=1/this._period;this._phase=this._period}}});WX.Sampler=function(a){WX.Unit.Generator.call(this);this.label+="Sampler";Object.defineProperties(this,{_buffer:{writable:!0,value:void 0},_player:{writable:!0,value:void 0},_url:{writable:!0,value:""},_basePitch:{writable:!0,value:60},_loaded:{writable:!0,value:!1},_defaults:{value:{basePitch:60}}});this.params=this._defaults;"object"===typeof a&&(this.params=a)};
WX.Sampler.prototype=Object.create(WX.Unit.Generator.prototype,{source:{enumerable:!0,get:function(){return this._url},set:function(a){if(void 0===a)return WX.error(this,"invalid audio file path."),!1;var b=this,c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="arraybuffer";c.onload=function(){try{b._buffer=WX._context.createBuffer(c.response,!0),b._loaded=!0,WX.info(b,"loaded: "+a)}catch(d){WX.error(b,"file loading error: "+a+" ("+d.message+")")}};c.send();this._url=a;return!0}},basePitch:{enumerable:!0,
get:function(){return this._basePitch},set:function(a){this._basePitch=a}},noteOn:{value:function(a){this._loaded?(this._player=WX._context.createBufferSource(),this._player.buffer=this._buffer,this._player.connect(this._outputGain),void 0!==a&&(a=Math.pow(2,(a-this._basePitch)/12),this._player.playbackRate.setValueAtTime(a,0)),this._player.start(0)):WX.error(this,"sampler is not ready.")}},noteOff:{value:function(a){this._player&&this._player.stop(a||0)}}});WX.ADSR=function(a){WX.Unit.Processor.call(this);this.label+="ADSR";Object.defineProperties(this,{_a:{writable:!0,value:0.0050},_d:{writable:!0,value:0.015},_tauDecay:{writable:!0,value:-0.015/Math.log(0.0010)},_s:{writable:!0,value:0.35},_r:{writable:!0,value:0.05},_tauRelease:{writable:!0,value:-0.05/Math.log(0.0010)},_running:{writable:!0,value:!1},_defaults:{value:{a:0.015,d:0.015,s:0.3,r:0.05,gain:1}}});this._inputGain.connect(this._outputGain);this._inputGain.gain.value=0;this.params=this._defaults;
"object"===typeof a&&(this.params=a)};
WX.ADSR.prototype=Object.create(WX.Unit.Processor.prototype,{a:{enumerable:!0,get:function(){return this._a},set:function(a){this._a=a}},d:{enumerable:!0,get:function(){return this._d},set:function(a){this._d=a;this._tauDecay=-this._d/Math.log(0.0010)}},s:{enumerable:!0,get:function(){return this._s},set:function(a){this._s=a}},r:{enumerable:!0,get:function(){return this._r},set:function(a){this._r=a;this._tauRelease=-this._r/Math.log(0.0010)}},running:{enumerable:!0,get:function(){return this._running},
set:function(){}},noteOn:{value:function(a){a=a||WX.now;var b=this._inputGain.gain;b.cancelScheduledValues(a);b.setValueAtTime(0,a);b.linearRampToValueAtTime(1,a+this._a);b.setTargetValueAtTime(this._s,a+this._a,this._tauDecay);this._running=!0}},noteOff:{value:function(a){a=a||WX.now;var b=this._inputGain.gain;b.cancelScheduledValues(a);b.setTargetValueAtTime(0,a,this._tauRelease);this._running=!1}}});WX.C2=function(a){WX.Unit.Processor.call(this);this.label+="C2";Object.defineProperties(this,{_threshold:{enumerable:!1,writable:!0,value:WX.db2lin(-12)},_ratio:{enumerable:!1,writable:!0,value:4},_iratio:{enumerable:!1,writable:!0,value:1/(this._ratio-1)},_makeup:{enumerable:!1,writable:!0,value:WX.db2lin(0)},_detector:{enumerable:!1,writable:!1,value:new WX.Internal.DualLevelDetector},_processor:{enumerable:!1,writable:!1,value:WX._context.createScriptProcessor(256,2,2)},_defaults:{value:{threshold:-12,
ratio:4,attack:0.01,release:0.25,makeup:8}}});var b=this;this._processor.onaudioprocess=function(a){b._callback(a)};this._inputGain.connect(this._processor);this._processor.connect(this._outputGain);this.params=this._defaults;"object"===typeof a&&(this.params=a)};
WX.C2.prototype=Object.create(WX.Unit.Processor.prototype,{_callback:{value:function(a){var b,c=a.inputBuffer.getChannelData(0),d=a.inputBuffer.getChannelData(1),g=a.outputBuffer.getChannelData(0);a=a.outputBuffer.getChannelData(1);for(var e=0;256>e;++e)b=Math.max(Math.abs(c[e]),Math.abs(d[e])),b=this._detector.process(b),b=WX.lin2db(b/this._threshold),b=0>=b?0:b*this._iratio,b=WX.db2lin(b),g[e]=c[e]*b*this._makeup,a[e]=d[e]*b*this._makeup}},threshold:{enumerable:!0,get:function(){return WX.lin2db(this._threshold)},
set:function(a){this._threshold=WX.db2lin(a)}},ratio:{enumerable:!0,get:function(){return this._ratio},set:function(a){this._ratio=a;this._iratio=1/(this._ratio-1)}},attack:{enumerable:!0,get:function(){return this._detector.attack},set:function(a){this._detector.attack=a}},release:{enumerable:!0,get:function(){return this._detector.release},set:function(a){this._detector.release=a}},makeup:{enumerable:!0,get:function(){return WX.lin2db(this._makeup)},set:function(a){this._makeup=WX.db2lin(a)}}});WX.Comp=function(a){WX.Unit.Processor.call(this);this.label+="Comp";Object.defineProperties(this,{_comp:{enumerable:!1,writable:!1,value:WX._context.createDynamicsCompressor()},_defaults:{value:{threshold:-12,ratio:4,knee:0.5,attack:0.01,release:0.25}}});this._inputGain.connect(this._comp);this._comp.connect(this._outputGain);this.params=this._defaults;"object"===typeof a&&(this.params=a)};
WX.Comp.prototype=Object.create(WX.Unit.Processor.prototype,{threshold:{enumerable:!0,get:function(){return this._comp.threshold.value},set:function(a){this._comp.threshold.value=a}},ratio:{enumerable:!0,get:function(){return this._comp.ratio.value},set:function(a){this._comp.ratio.value=a}},knee:{enumerable:!0,get:function(){return this._comp.knee.value},set:function(a){this._comp.knee.value=a}},attack:{enumerable:!0,get:function(){return this._comp.attack.value},set:function(a){this._comp.attack.value=
a}},release:{enumerable:!0,get:function(){return this._comp.release.value},set:function(a){this._comp.release.value=a}}});WX.ConVerb=function(a){WX.Unit.Processor.call(this);this.label+="ConVerb";Object.defineProperties(this,{_convolver:{enumerable:!1,writable:!1,value:WX._context.createConvolver()},_dry:{enumerable:!1,writable:!1,value:WX._context.createGain()},_wet:{enumerable:!1,writable:!1,value:WX._context.createGain()},_url:{enumerable:!1,writable:!0,value:null},_defaults:{value:{source:null,mix:0.25}}});this._inputGain.connect(this._convolver);this._inputGain.connect(this._dry);this._convolver.connect(this._wet);
this._dry.connect(this._outputGain);this._wet.connect(this._outputGain);"object"===typeof a&&(this.params=a)};
WX.ConVerb.prototype=Object.create(WX.Unit.Processor.prototype,{source:{enumerable:!0,get:function(){return this._url},set:function(a){if(void 0===a||null===a)return WX.error(this,"invalid IR file path."),!1;var b=this,c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="arraybuffer";c.onload=function(){try{b._convolver.buffer=WX._context.createBuffer(c.response,!0),WX.info(b,"loaded: "+a)}catch(d){WX.error(b,"file loading error: "+a+" ("+d.message+")")}};c.send();this._url=a;return!0}},mix:{enumerable:!0,
get:function(){return this._wet.gain.value},set:function(a){this._wet.gain.value=a;this._dry.gain.value=1-a}}});WX.Fader=function(a){WX.Unit.Processor.call(this);this.label+="Fader";Object.defineProperties(this,{_muted:{enumerable:!1,writable:!0,value:!1},_defaults:{value:{db:0}}});this._inputGain.connect(this._outputGain);this.params=this._defaults;"object"===typeof a&&(this.params=a)};
WX.Fader.prototype=Object.create(WX.Unit.Processor.prototype,{mute:{enumerable:!0,get:function(){return this._muted},set:function(a){!0===a?(this._muted=!0,this._inputGain.gain.value=0):(this._muted=!1,this._inputGain.gain.value=1)}},db:{enumerable:!0,get:function(){return WX.lin2db(this._outputGain.gain.value)},set:function(a){this._outputGain.gain.value=WX.db2lin(a)}}});WX.DAC=new WX.Fader;WX.DAC.connect(WX._context.destination);WX.LPF=function(a){WX.Unit.Processor.call(this);this.label+="LPF";Object.defineProperties(this,{_lpf:{enumerable:!1,writable:!1,value:WX._context.createBiquadFilter()},_cutoff:{writable:!0,value:1E3},_Q:{writable:!0,value:10},_defaults:{value:{cutoff:1E3,Q:10}}});this._inputGain.connect(this._lpf);this._lpf.connect(this._outputGain);this._lpf.type=0;this.params=this._defaults;"object"===typeof a&&(this.params=a);WX.bindParam.call(this,"mcutoff",this._lpf.frequency);WX.bindParam.call(this,"mQ",this._lpf.Q)};
WX.LPF.prototype=Object.create(WX.Unit.Processor.prototype,{cutoff:{enumerable:!0,get:function(){return this._lpf.frequency.value},set:function(a){this._lpf.frequency.value=a}},Q:{enumerable:!0,get:function(){return this._lpf.Q.value},set:function(){this._lpf.Q.value=this._Q}}});WX.ModLPF=function(a){WX.Unit.Processor.call(this);this.label+="ModLPF";Object.defineProperties(this,{_lpf1:{enumerable:!1,writable:!1,value:WX._context.createBiquadFilter()},_lpf2:{enumerable:!1,writable:!1,value:WX._context.createBiquadFilter()},_cutoff:{writable:!0,value:1E3},_Q:{writable:!0,value:10},_a:{writable:!0,value:0.0050},_d:{writable:!0,value:0.015},_tauDecay:{writable:!0,value:-0.015/Math.log(0.0010)},_s:{writable:!0,value:0.35},_r:{writable:!0,value:0.015},_tauRelease:{writable:!0,
value:-0.05/Math.log(0.0010)},_running:{writable:!0,value:!1},_range:{writable:!0,value:1E3},_defaults:{value:{cutoff:1E3,Q:10,range:1E3,a:0.015,d:0.015,s:0.3,r:0.05}}});this._inputGain.connect(this._lpf1);this._lpf1.connect(this._lpf2);this._lpf2.connect(this._outputGain);this._lpf1.type=this._lpf2.type=0;this.params=this._defaults;"object"===typeof a&&(this.params=a)};
WX.ModLPF.prototype=Object.create(WX.Unit.Processor.prototype,{cutoff:{enumerable:!0,get:function(){return this._cutoff},set:function(a){this._cutoff=a}},Q:{enumerable:!0,get:function(){return this._Q},set:function(a){this._Q=a;this._lpf1.Q.value=this._Q;this._lpf2.Q.value=this._Q}},a:{enumerable:!0,get:function(){return this._a},set:function(a){this._a=a}},d:{enumerable:!0,get:function(){return this._d},set:function(a){this._d=a;this._tauDecay=-this._d/Math.log(0.0010)}},s:{enumerable:!0,get:function(){return this._s},
set:function(a){this._s=a}},r:{enumerable:!0,get:function(){return this._r},set:function(a){this._r=a;this._tauRelease=-this._r/Math.log(0.0010)}},running:{enumerable:!0,get:function(){return this._running}},range:{enumerable:!0,get:function(){return this._range},set:function(a){this._range=a}},noteOn:{value:function(a){a=a||WX.now;var b=this._lpf1.frequency,c=this._lpf2.frequency;b.cancelScheduledValues(a);b.setValueAtTime(this._cutoff,a);c.cancelScheduledValues(a);c.setValueAtTime(this._cutoff,
a);var d=this._cutoff+this._range;b.linearRampToValueAtTime(d,a+this._a);b.setTargetValueAtTime(d*this._s,a+this._a,this._tauDecay);c.linearRampToValueAtTime(d,a+this._a);c.setTargetValueAtTime(d*this._s,a+this._a,this._tauDecay);this._running=!0}},noteOff:{value:function(a){a=a||WX.now;var b=this._lpf1.frequency,c=this._lpf2.frequency;b.cancelScheduledValues(a);c.cancelScheduledValues(a);b.setTargetValueAtTime(this._cutoff,a,this._tauRelease);c.setTargetValueAtTime(this._cutoff,a,this._tauRelease);
this._running=!1}}});WX.TwinDelay=function(a){WX.Unit.Processor.call(this);this.label+="TwinDelay";Object.defineProperties(this,{_delayL:{enumerable:!1,writable:!1,value:WX._context.createDelay()},_delayR:{enumerable:!1,writable:!1,value:WX._context.createDelay()},_merger:{enumerable:!1,writable:!1,value:WX._context.createChannelMerger(2)},_fbL:{enumerable:!1,writable:!1,value:WX._context.createGain()},_fbR:{enumerable:!1,writable:!1,value:WX._context.createGain()},_crosstalkL:{enumerable:!1,writable:!1,value:WX._context.createGain()},
_crosstalkR:{enumerable:!1,writable:!1,value:WX._context.createGain()},_dry:{enumerable:!1,writable:!1,value:WX._context.createGain()},_wet:{enumerable:!1,writable:!1,value:WX._context.createGain()},_defaults:{value:{delayTimeLeft:0.125,delayTimeRight:0.25,feedbackLeft:0.25,feedbackRight:0.25,crosstalk:0.1,mix:0.5}}});this._inputGain.connect(this._delayL);this._inputGain.connect(this._delayR);this._inputGain.connect(this._dry);this._delayL.connect(this._fbL);this._delayR.connect(this._fbR);this._fbL.connect(this._delayL);
this._fbR.connect(this._delayR);this._fbL.connect(this._crosstalkR);this._fbR.connect(this._crosstalkL);this._crosstalkR.connect(this._delayR);this._crosstalkL.connect(this._delayL);this._delayL.connect(this._merger,0,0);this._delayR.connect(this._merger,0,1);this._merger.connect(this._wet);this._dry.connect(this._outputGain);this._wet.connect(this._outputGain);this.params=this._defaults;"object"===typeof a&&(this.params=a)};
WX.TwinDelay.prototype=Object.create(WX.Unit.Processor.prototype,{delayTimeLeft:{enumerable:!0,get:function(){return this._delayL.delayTime.value},set:function(a){this._delayL.delayTime.value=a}},delayTimeRight:{enumerable:!0,get:function(){return this._delayR.delayTime.value},set:function(a){this._delayR.delayTime.value=a}},feedbackLeft:{enumerable:!0,get:function(){return this._fbL.gain.value},set:function(a){this._fbL.gain.value=a}},feedbackRight:{enumerable:!0,get:function(){return this._fbR.gain.value},
set:function(a){this._fbR.gain.value=a}},crosstalk:{enumerable:!0,get:function(){return this._crosstalkL.gain.value},set:function(a){this._crosstalkL.gain.value=a;this._crosstalkR.gain.value=a}},mix:{enumerable:!0,get:function(){return this._wet.gain.value},set:function(a){this._wet.gain.value=a;this._dry.gain.value=1-a}}});WX.Waveform=function(a){WX.Unit.Analyzer.call(this);this.label+="Waveform";Object.defineProperties(this,{_context2D:{writable:!0,value:null},_buffer:{writable:!0,value:new Uint8Array(this._analyzer.frequencyBinCount)},_pause:{writable:!0,value:!1},_autoClear:{writable:!0,value:!0},_defaults:{value:{}}});this.params=this._defaults;"object"===typeof a&&(this.params=a)};
WX.Waveform.prototype=Object.create(WX.Unit.Analyzer.prototype,{_updateSize:{value:function(){this._unitX=this._context2D.canvas.width/this._buffer.length;this._scaleY=this._context2D.canvas.height}},context:{enumerable:!0,get:function(){return this._context2D},set:function(a){void 0===a||null===a?WX.error(this,"invalid drawing context."):(this._context2D=a,this._updateSize())}},pause:{enumerable:!0,get:function(){return this._pause},set:function(a){this._pause=a}},autoClear:{enumerable:!0,get:function(){return this._autoClear},
set:function(a){this._autoClear=a}},draw:{value:function(){if(!this._pause){this._analyzer.getByteTimeDomainData(this._buffer);var a=this._context2D;this._autoClear&&a.clearRect(0,0,a.canvas.width,a.canvas.height);a.beginPath();a.moveTo(0,(1-this._buffer[0]/255)*this._scaleY);for(var b=1,c=this._buffer.length;b<c;++b)a.lineTo(b*this._unitX,(1-this._buffer[b]/255)*this._scaleY);a.stroke()}}}});WX.Spectrum=function(a){WX.Unit.Analyzer.call(this);this.label+="Spectrum";Object.defineProperties(this,{_context2D:{writable:!0,value:null},_buffer:{writable:!0,value:new Uint8Array(this._analyzer.frequencyBinCount)},_pause:{writable:!0,value:!1},_autoClear:{writable:!0,value:!0},_defaults:{value:{}}});this.params=this._defaults;"object"===typeof a&&(this.params=a)};
WX.Spectrum.prototype=Object.create(WX.Unit.Analyzer.prototype,{_updateSize:{value:function(){this._unitX=this._context2D.canvas.width/this._buffer.length;this._scaleY=this._context2D.canvas.height}},context:{enumerable:!0,get:function(){return this._context2D},set:function(a){void 0===a||null===a?WX.error(this,"invalid drawing context."):(this._context2D=a,this._updateSize())}},pause:{enumerable:!0,get:function(){return this._pause},set:function(a){this._pause=a}},autoClear:{enumerable:!0,get:function(){return this._autoClear},
set:function(a){this._autoClear=a}},draw:{value:function(){if(!this._pause){this._analyzer.getByteFrequencyData(this._buffer);var a=this._context2D;this._autoClear&&a.clearRect(0,0,a.canvas.width,a.canvas.height);a.beginPath();a.moveTo(0,(1-this._buffer[b]/255)*this._scaleY);for(var b=1,c=this._buffer.length;b<c;++b)a.lineTo(b*this._unitX,(1-this._buffer[b]/255)*this._scaleY);a.stroke()}}}});WX.Visualizer=function(a){WX.Unit.Analyzer.call(this);this.label+="Visualizer";Object.defineProperties(this,{_drawCallback:{writable:!0,value:function(){}},_context:{writable:!0,value:null},_buffer:{writable:!0,value:new Uint8Array(this._analyzer.frequencyBinCount)},_width:{writable:!0,value:600},_height:{writable:!0,value:300},_pause:{writable:!0,value:!1},_defaults:{value:{}}});this.params=this._defaults;"object"===typeof a&&(this.params=a)};
WX.Visualizer.prototype=Object.create(WX.Unit.Analyzer.prototype,{context:{enumerable:!0,get:function(){return this._context},set:function(a){void 0===a?WX.error(this,"invalid drawing context. (undefined)"):(this._context=a,this.updateSize())}},pause:{enumerable:!0,get:function(){return this._pause},set:function(a){this._pause=a}},bufferSize:{enumerable:!0,get:function(){return this._buffer.length},set:function(){}},onRender:{set:function(a){this._drawCallback=a},get:function(){return this._drawCallback}},
updateSize:{value:function(){this._width=this._context.canvas.width;this._height=this._context.canvas.height}},draw:{value:function(){this._pause||(this._analyzer.getByteTimeDomainData(this._buffer),this._drawCallback.call(this,this._buffer,this._context,this._width,this._height))}}});WX.UIManager=Object.create(null,{selected:{writable:!0,value:null},onClicked:{writable:!0,value:null},onDragged:{writable:!0,value:null},onReleased:{writable:!0,value:null},rad2degFactor:{value:180/Math.PI}});WX.UISliderH=function(a){Object.defineProperties(this,{_container:{value:document.createElement("div")},_placeholder:{value:document.createElement("div")},_control:{value:document.createElement("div")},_label:{value:document.createElement("div")},_rect:{writable:!0,value:null},_pos:{writable:!0,value:{x:0,y:0}},_prev:{writable:!0,value:{x:0,y:0}},_params:{writable:!0,value:{val:a.value||0,offset:a.offset||0,scale:a.scale||1,defaultVal:a.value||0}},_target:{writable:!0,value:null},_targetVal:{writable:!0,
value:null}});this._build(a);this._rect=this._placeholder.getBoundingClientRect();this._params.val=this._params.defaultVal;this._pos.x=(this._params.val-this._params.offset)/this._params.scale*(this._rect.width-18);this._pos.x=Math.min(this._rect.width-18,Math.max(0,this._pos.x));this._control.style.left=this._pos.x+"px";return this};
WX.UISliderH.prototype=Object.create(null,{_build:{value:function(a){this._container.appendChild(this._placeholder);this._container.appendChild(this._label);this._placeholder.appendChild(this._control);var b=a.targetDiv;if(void 0===b||null===b)throw console.err("invalid UI panel div"),"error";b.appendChild(this._container);this._container.style.left=a.x+"px";this._container.style.top=a.y+"px";this._container.className="wx-sliderH-container";this._placeholder.className="wx-sliderH-placeholder wx-gui-light";
this._control.className="wx-sliderH-control wx-gui-light";this._label.className="wx-sliderH-label";this._label.textContent=a.label;var c=this;this._placeholder.addEventListener("mousedown",function(a){c._controlClicked.call(c,a)},!1)}},_controlClicked:{value:function(a){a.preventDefault();this._prev.x=a.clientX-this._rect.left;var b=this;WX.UIManager.selected=b;WX.UIManager.onDragged=function(a){b._controlDragged.call(b,a)};WX.UIManager.onReleased=function(a){b._controlReleased.call(b,a)};window.addEventListener("mousemove",
WX.UIManager.onDragged,!1);window.addEventListener("mouseup",WX.UIManager.onReleased,!1)}},_controlDragged:{value:function(a){a.preventDefault();a=a.clientX-this._rect.left;this._pos.x+=a-this._prev.x;this._pos.x=Math.min(this._rect.width-18,this._pos.x);this._pos.x=Math.max(0,this._pos.x);this._control.style.left=this._pos.x+"px";this._prev.x=a;this._params.val=this._pos.x/(this._rect.width-18)*this._params.scale+this._params.offset;this._label.textContent=this._params.val.toFixed(2);this._target&&
this._target.setValueAtTime(this._params.val,0);this._targetValue&&(this._targetValue.object[this._targetValue.property]=this._params.val)}},_controlReleased:{value:function(a){a.preventDefault();window.removeEventListener("mousemove",WX.UIManager.onDragged,!1);window.removeEventListener("mouseup",WX.UIManager.onReleased,!1);WX.UIManager.selected=null;WX.UIManager.onClicked=null;WX.UIManager.onDragged=null;WX.UIManager.onReleased=null}},target:{set:function(a){this._target=a},get:function(){return this._target}},
getValue:{value:function(){return this._params.val}},setTargetValue:{value:function(a,b){this._targetValue={object:a,property:b}}}});WX.UISliderV=function(a){Object.defineProperties(this,{_container:{value:document.createElement("div")},_placeholder:{value:document.createElement("div")},_control:{value:document.createElement("div")},_label:{value:document.createElement("div")},_rect:{writable:!0,value:null},_pos:{writable:!0,value:{x:0,y:0}},_prev:{writable:!0,value:{x:0,y:0}},_params:{writable:!0,value:{val:a.value||0,offset:a.offset||0,scale:a.scale||1,defaultVal:a.value||0}},_target:{writable:!0,value:null},_targetValue:{writable:!0,
value:null}});this._build(a);this._rect=this._placeholder.getBoundingClientRect();this._params.val=this._params.defaultVal;this._pos.y=(this._params.val-this._params.offset)/this._params.scale*(this._rect.height-18);this._pos.y=Math.min(this._rect.height-18,Math.max(0,this._pos.x));this._control.style.top=this._pos.y+"px";return this};
WX.UISliderV.prototype=Object.create(null,{_build:{value:function(a){this._container.appendChild(this._placeholder);this._container.appendChild(this._label);this._placeholder.appendChild(this._control);var b=a.targetDiv;if(void 0===b||null===b)throw console.err("invalid UI panel div"),"error";b.appendChild(this._container);this._container.style.left=a.x+"px";this._container.style.top=a.y+"px";this._container.className="wx-sliderV-container";this._placeholder.className="wx-sliderV-placeholder wx-gui-light";
this._control.className="wx-sliderV-control wx-gui-light";this._label.className="wx-sliderV-label";this._label.textContent=a.label;var c=this;this._placeholder.addEventListener("mousedown",function(a){c._controlClicked.call(c,a)},!1)}},_controlClicked:{value:function(a){a.preventDefault();this._prev.y=a.clientY-this._rect.top;var b=this;WX.UIManager.selected=b;WX.UIManager.onDragged=function(a){b._controlDragged.call(b,a)};WX.UIManager.onReleased=function(a){b._controlReleased.call(b,a)};window.addEventListener("mousemove",
WX.UIManager.onDragged,!1);window.addEventListener("mouseup",WX.UIManager.onReleased,!1)}},_controlDragged:{value:function(a){a.preventDefault();a=a.clientY-this._rect.top;this._pos.y+=a-this._prev.y;this._pos.y=Math.min(this._rect.height-18,this._pos.y);this._pos.y=Math.max(0,this._pos.y);this._control.style.top=this._pos.y+"px";this._prev.y=a;this._params.val=this._pos.y/(this._rect.height-18)*this._params.scale+this._params.offset;this._target&&this._target.setValueAtTime(this._params.val,0);this._targetValue&&
(this._targetValue.object[this._targetValue.property]=this._params.val)}},_controlReleased:{value:function(a){a.preventDefault();window.removeEventListener("mousemove",WX.UIManager.onDragged,!1);window.removeEventListener("mouseup",WX.UIManager.onReleased,!1);WX.UIManager.selected=null;WX.UIManager.onClicked=null;WX.UIManager.onDragged=null;WX.UIManager.onReleased=null}},getValue:function(){return this._params.val},target:{set:function(a){this._target=a},get:function(){return this._target}},setTargetValue:{value:function(a,
b){this._targetValue={object:a,property:b}}}});WX.UIKnob=function(a){Object.defineProperties(this,{_container:{value:document.createElement("div")},_placeholder:{value:document.createElement("div")},_control:{value:document.createElement("div")},_label:{value:document.createElement("div")},_rect:{writable:!0,value:null},_angle:{writable:!0,value:0},_prevAngle:{writable:!0,value:0},_params:{writable:!0,value:{val:a.value||0,offset:a.offset||0,scale:a.scale||1,defaultVal:a.value||0}},_target:{writable:!0,value:null},_targetValue:{writable:!0,value:null}});
this._build(a);this._rect=this._placeholder.getBoundingClientRect();this._params.val=this._params.defaultVal;this._angle=270*((this._params.val-this._params.offset)/this._params.scale)+45;this._angle=Math.min(315,Math.max(45,this._angle));this._control.style.webkitTransform="rotate("+this._angle+"deg)";return this};
WX.UIKnob.prototype=Object.create(null,{_build:{value:function(a){this._container.appendChild(this._placeholder);this._container.appendChild(this._label);this._placeholder.appendChild(this._control);var b=a.targetDiv;if(void 0===b||null===b)throw console.err("invalid UI panel div"),"error";b.appendChild(this._container);this._container.style.left=a.x+"px";this._container.style.top=a.y+"px";this._container.className="wx-knob-container";this._placeholder.className="wx-knob-placeholder wx-gui-light";
this._control.className="wx-knob-control wx-gui-light";this._label.className="wx-knob-label";this._label.textContent=a.label;var c=this;this._placeholder.addEventListener("mousedown",function(a){c._handleClicked.call(c,a)},!1)}},_getCurrentAngle:{value:function(a,b){var c=180*Math.atan2(this._rect.top+this._rect.height/2-b,this._rect.left+this._rect.width/2-a)/Math.PI+90;return 0<c?c:c+360}},_handleClicked:{value:function(a){a.preventDefault();this._prevAngle=this._getCurrentAngle(a.clientX,a.clientY);
var b=this;WX.UIManager.selected=b;WX.UIManager.onDragged=function(a){b._handleDragged.call(b,a)};WX.UIManager.onReleased=function(a){b._handleReleased.call(b,a)};window.addEventListener("mousemove",WX.UIManager.onDragged,!1);window.addEventListener("mouseup",WX.UIManager.onReleased,!1)}},_handleDragged:{value:function(a){a.preventDefault();a=this._getCurrentAngle(a.clientX,a.clientY);var b=a-this._prevAngle;180<b||-180>b||(this._angle+=b,this._angle=Math.min(315,Math.max(45,this._angle)),this._control.style.webkitTransform=
"rotate("+this._angle+"deg)",this._params.val=(this._angle-45)/270*this._params.scale+this._params.offset,this._label.textContent=this._params.val.toFixed(2),this._prevAngle=a,this._target&&this._target.setValueAtTime(this._params.val,0),this._targetValue&&(this._targetValue.object[this._targetValue.property]=this._params.val))}},_handleReleased:{value:function(a){a.preventDefault();window.removeEventListener("mousemove",WX.UIManager.onDragged,!1);window.removeEventListener("mouseup",WX.UIManager.onReleased,
!1);WX.UIManager.selected=null;WX.UIManager.onClicked=null;WX.UIManager.onDragged=null;WX.UIManager.onReleased=null}},target:{set:function(a){this._target=a},get:function(){return this._target}},getValue:{value:function(){return this._params.val}},setTargetValue:{value:function(a,b){this._targetValue={object:a,property:b}}}});
